<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>나날의 기록들</title>
    <link type="text/css" rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-71626726-1', 'auto');
    ga('send', 'pageview');

</script>

    <div class="container">
        <div id="sideBar">
            <a class="logout" href="/user/logout">로그아웃 </a>
            <ul>
                <li class="userImage"><img src="/static/image/{{ user_image }}.jpg"></li>
                <li class="loginedLabel"><span id="loginedUserName">{{ user_name }}</span> 님</li>
                <li>오늘도 좋은 하루!</li>
                <li>즐거운 X을 해보세요!!</li>
            </ul>
        </div>
        <div id="content">
            <div class="contentBody">
                <div class="logform-deco">어떤 사건이 있었나요?</div>
                <form class="logForm shadow metal" action="/eungalog" method="post">
                    <div>
                        <ul>
                            <li>
                                <label for="weather">지금 날씨 어때요?</label>
                                <select name="weather" id="weather">
                                    <option value="1">맑음</option>
                                    <option value="2">흐림</option>
                                    <option value="3">구림</option>
                                    <option value="4">비</option>
                                    <option value="5">눈</option>
                                    <option value="6">불벼락</option>
                                </select>
                            </li>
                            <li>
                                <label for="size">얼마나 컸나요?</label>
                                <select name="size" id="size">
                                    <option value="1">인간초월</option>
                                    <option value="2">상</option>
                                    <option value="3">중</option>
                                    <option value="4">하</option>
                                    <option value="5">. <- 이 정도..?</option>
                                    <option value="6">하아.... 실패..</option>
                                </select>
                            </li>
                            <li>
                                <label for="feature">뭔가 특이사항이 있었어요?</label>
                                <select name="feature" id="feature">
                                    <option value="1">특이사항 없음</option>
                                    <option value="2">급똥</option>
                                    <option value="3">치질</option>
                                    <option value="4">변비</option>
                                    <option value="5">그 외</option>
                                </select>
                            </li>
                            <li>
                                <label for="satisfaction">만족한 정도를 알려주세요</label>
                                <select name="satisfaction" id="satisfaction">
                                    <option value="1">인생 최고의 날</option>
                                    <option value="2">극상의 만족</option>
                                    <option value="3">보통</option>
                                    <option value="4">애매함</option>
                                    <option value="5">불만족</option>
                                    <option value="6">분노</option>
                                </select>
                            </li>
                        </ul>
                    </div>
                    <button class="logSubmitButton metalButton" type="submit">push!</button>
                </form>

                <div class="logList">
                    <ul>
                        {% for log in log_list %}
                            <li class="logCard shadow">
                                <div class="bind">
                                    <div>일시 : {{log.datetime}}</div>
                                    <div>날씨 : {{log.weather}}</div>
                                    <div>크기 : {{log.size}}</div>
                                    <div>특이사항 : {{log.feature}}</div>
                                    <div>만족도 : {{log.satisfaction}}</div>
                                </div>
                                <div class="clear"></div>
                                <input type="hidden" class="hiddenId" value="{{ log.id }}" >
                                <div class="log-contents"> {{log.drip}}</div>
                                <div class="deleteButton">X</div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        window.addEventListener("load", function () {
            setDeleteLogEvent();
        }, false);

        function setDeleteLogEvent () {
            var buttons = document.body.querySelectorAll('.deleteButton');
            [].forEach.call(buttons, function(button) {
                button.addEventListener("click", function(e) {
                    e.preventDefault();
                    deleteLog(e);
                }, false);
            });
        }

        function deleteLog (event) {
            var logId = event.target.parentElement.querySelector('.hiddenId').value;
            event.target.parentElement.style.backgroundColor = "yellow";
            alert('선택하신 역사를 삭제합니다.');
            fetch("/eungalog/"+logId, { method: "DELETE" })
                    .then(function(res) {
                        if (res.ok) {
                            alert('하나의 역사가 사라졌습니다.');
                            location.href='/';
                        } else {
                            alert("역사를 지우는데 실패했습니다.");
                            console.log('failed log delete')
                        }
                    }
            );
        };
    </script>
</body>
</html>